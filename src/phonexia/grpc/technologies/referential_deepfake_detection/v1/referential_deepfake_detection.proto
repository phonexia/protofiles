// Copyright 2025 Phonexia s.r.o.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

// Phonexia Referential Deepfake Detection gRPC API.
syntax = "proto3";

package phonexia.grpc.technologies.referential_deepfake_detection.v1;

import "google/protobuf/duration.proto";
import "phonexia/grpc/common/core.proto";

// Service implementing referential deepfake detection.
service ReferentialDeepfakeDetection {
  // Performs referential deepfake detection by comparing reference audio against questioned audio.
  rpc Detect(stream DetectRequest) returns (DetectResponse);
}

// The top level message sent by the client for the <code>Detect</code> method.
//
// This message contains both reference and questioned data for deepfake detection.
// Currently, only audio input is supported.
//
// The service will compare the reference data against the questioned data to determine
// if the questioned data is likely to be a deepfake of the reference speaker's voice.
//
// When using streaming, send the reference audio first, followed by the questioned audio.
//
// <b>IMPORTANT:</b> The reference data must be bona fide (genuine). If the reference
// is a deepfake, the algorithm will fail to produce valid results. Additionally, the speaker
// roles cannot be interchanged -- you must send the reference speaker in audio_reference and the
// questioned speaker in audio_questioned. Reversing these assignments may yield an incorrect score.
//
// The audio should contain at least 0.3125 seconds of speech. If the audio contains less speech,
// the <code>score</code> will be empty.
message DetectRequest {
  // Reference data for referential deepfake detection.
  // Currently only audio is supported. Additional input types may be added in the future.
  oneof reference {
    phonexia.grpc.common.Audio audio_reference = 1;
  }

  // Questioned data for referential deepfake detection.
  // Currently only audio is supported. Additional input types may be added in the future.
  oneof questioned {
    phonexia.grpc.common.Audio audio_questioned = 4;
  }
}

// The top level message returned to the client by the <code>Detect</code>
// method.
message DetectResponse {
  // The result of referential deepfake detection.
  DetectResult result = 1;

  // Total length of the processed audio.
  google.protobuf.Duration processed_audio_length = 2;
}

// Message representing the result of referential deepfake detection.
message DetectResult {
  // Score of the referential deepfake detection. A higher score indicates a higher 
  // likelihood of the questioned data being a deepfake. The score is a floating-point
  // value. While technically limited by floating-point representation,
  // scores are typically within a certain range that varies model to model.
  // Empty if not enough speech was present in the input data.
  float score = 1;
}
